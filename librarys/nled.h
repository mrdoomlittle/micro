# include "../micro.h"
# include "../shift_reg.h"
# include <mdlint.h>

struct nled_t {
	struct shift_reg_t shift_reg;
	mdl_u8_t pid_layout[8];
};

void nled_init(struct nled_t *__nled, mdl_u8_t __data_pid, mdl_u8_t __latch_pid, mdl_u8_t __clock_pid, mdl_u8_t *__pid_layout) {
	__nled-> shift_reg.data_flow = SHIFT_REG_OUT;
	__nled-> shift_reg.data_pid = __data_pid;
	__nled-> shift_reg.latch_pid = __latch_pid;
	__nled-> shift_reg.clock_pid = __clock_pid;
	shift_reg_init(&__nled-> shift_reg);
	for (mdl_u8_t ic = 0; ic != 8; ic++)
		__nled-> pid_layout[ic] = __pid_layout[ic];
}

mdl_u8_t const no_pseq[10][8] = {
	{0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x0, 0x1}, // no 0
	{0x0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x1}, // no 1
	{0x1, 0x1, 0x0, 0x1, 0x1, 0x0, 0x1, 0x1}, // no 2
	{0x1, 0x1, 0x1, 0x1, 0x0, 0x0, 0x1, 0x1}, // no 3
	{0x0, 0x1, 0x1, 0x0, 0x0, 0x1, 0x1, 0x1}, // no 4
	{0x1, 0x0, 0x1, 0x1, 0x0, 0x1, 0x1, 0x0}, // no 5
	{0x1, 0x0, 0x1, 0x1, 0x1, 0x1, 0x1, 0x0}, // no 6
	{0x1, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0}, // no 7
	{0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x0}, // no 8
	{0x1, 0x1, 0x1, 0x1, 0x0, 0x1, 0x1, 0x0} // no 9
};

void nled_set(struct nled_t *__nled, mdl_u8_t __no) {
	if (__no > 9) return;
	mdl_u8_t ps_list[8];
	for (mdl_u8_t ic = 0; ic != 8; ic++)
		ps_list[ic] = no_pseq[__no][__nled-> pid_layout[ic]];

	shift_reg_set(&__nled-> shift_reg, ps_list);
}
